---
title: "Finding Emergency Sanitary Pad Stations in City Corners (寻找城市角落的紧急卫生巾站)"
author: "Group 1"
date: "`r Sys.Date()`"
format:
    bookup-html:
        toc: true
        toc-depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


<style>
/* Base styles for sidebar */
#sidebarleft {
  position: fixed;
  top: 0;
  left: 0;
  width: 25%; /* Use percentage for responsive sizing */
  height: 100vh;
  background-color: grey;
  background-image: url('girl.png');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: 1000;
}

/* Ensure that content does not overlap with the sidebar */
#quarto-content {
  margin-left: calc(20% + 1rem); /* Use calc to dynamically calculate margin */
}

/* Adjust sidebar and content on smaller screens */
@media (max-width: 1024px) {
  #sidebarleft {
    width: 20%;
  }
  #quarto-content {
    margin-left: calc(20% + 1rem);
  }
}

@media (max-width: 768px) {
  #sidebarleft {
    width: 25%;
  }
  #quarto-content {
    margin-left: calc(25% + 1rem);
  }
  
}

@media (max-width: 480px) {
  #sidebarleft {
    width: 35%;
  }
  #quarto-content {
    margin-left: calc(35% + 1rem);
  }
}

.sidebar.toc-left, .sidebar.margin-sidebar {
  position: fixed;
  top: 0;
  right: 0;
  width: 10vw;
  max-width: 300px;
  height: 100vh;
  overflow-y: auto;
  z-index: 1050;
}

.content {
  margin-right: 1rem; /* Add some space on the right */
}

/* Additional styles to ensure no overlap */
#quarto-content.page-columns #quarto-margin-sidebar, #quarto-content.page-columns #quarto-sidebar {
    grid-column-start: 3;
}

.sidebar.toc-left, .sidebar.margin-sidebar {
  margin-left: 26px; /* Adjust if necessary */
}
  

</style>


<div id="sidebarleft"></div>

########### Contents

# Introduction
## Background and Purpose
Introduce the necessity of emergency sanitary pad stations in urban areas, referencing the importance of accessibility and public health.

## Scope of the Study
Define the geographical and demographic scope of your research. （可提及主要的两个部分，一个是可视化，一个是小程序那里under development的那个设备，太阳能那个，提第二点时提我们有算一些东西）

# Methodology

## Data Collection
Outline the methods used to gather data on sanitary pad dispensers, including any surveys, field studies, or database analyses.

## Interactive Plot Explanation
Describe how the interactive plot was developed and how it visualizes the data.

# Analysis of Current Situation
## Distribution of Dispensers
Present findings on the number and locations of sanitary pad dispensers across different districts.

## Accessibility and Visibility
Assess how accessible and visible these stations are to the public.

# Comparative Study
## Benchmarking
Compare the availability of sanitary pad dispensers in your study area with other cities or standards, if applicable.

## Lessons from Previous Studies
Reference the "育婴室" (baby care rooms) study as a benchmark or point of comparison.

# Interactive Plot Section
## Data Visualization
Present the interactive plot showing the distribution of sanitary pad dispensers.

## Interpretation of Data

```{r}
# Load necessary libraries
library(dplyr)
library(scales)

# Create data frame
data <- data.frame(
  quantity = c(3, 1, 17, 10, NA, 18, 7, NA, 28, 4, 17, 9, 5, 23, 7, 5, 3, 6, NA, NA, 6, NA, NA, 35, 6, 3, 6, 5, NA),
  distance_to_metro = c(126, 159, 274, 814, 1700, 574, 110, 109, 435, 473, 1300, 1200, 1600, 1500, 1000, 1200, 697, 798, 1000, 767, 876, 766, 488, 2000, 1200, 3000, 386, 273, 860),
  score = 1:29
)

# Min-Max Normalization
df_minmax <- as.data.frame(lapply(data, function(x) ifelse(is.na(x), NA, rescale(x))))

# Standardization (Z-score normalization)
df_standardized <- as.data.frame(scale(data))

# Log Transformation - Handling NA values
df_log <- data
df_log$quantity <- ifelse(is.na(df_log$quantity), NA, log(df_log$quantity + 1))
df_log$distance_to_metro <- ifelse(is.na(df_log$distance_to_metro), NA, log(df_log$distance_to_metro + 1))


library(openxlsx)

# Create a new workbook
wb <- createWorkbook()

# Add sheets and write data to each sheet
addWorksheet(wb, "Min-Max Normalization")
writeData(wb, sheet = "Min-Max Normalization", df_minmax)

addWorksheet(wb, "Standardization")
writeData(wb, sheet = "Standardization", df_standardized)

addWorksheet(wb, "Log Transformation")
writeData(wb, sheet = "Log Transformation", df_log)

# Save the workbook as an Excel file
saveWorkbook(wb, "NormalizedData.xlsx", overwrite = TRUE)
```



Provide insights and trends identified from the interactive plot.



<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive Map with ECharts</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      #mapContainer,
      #scatterContainer {
        width: 600px;
        height: 400px;
        border: 1px solid #ccc;
        margin: 10px;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <div id="mapContainer"></div>
    <div id="scatterContainer"></div>

    <script>
      var mapChart = echarts.init(document.getElementById("mapContainer"));
      var scatterChart = echarts.init(
        document.getElementById("scatterContainer")
      );

      // Define synthetic data for map points and scatter plot
      var mapPoints = {
        天河区: {
          value: [113.362, 23.1246],
          scatter: [
            { distance: 10, number: 3, score: 80 },
            { distance: 3, number: 1, score: 70 },
          ],
        },
        宝安区: {
          value: [113.8831, 22.5533],
          scatter: [
            { distance: 10, number: 3, score: 80 },
            { distance: 3, number: 1, score: 70 },
            { distance: 2, number: 5, score: 40 },
          ],
        },
        南山区: {
          value: [113.9304, 22.5333],
          scatter: [{ distance: 2, number: 5, score: 40 }],
        },
        福田区: {
          value: [114.0545, 22.5229],
          scatter: [{ distance: 2, number: 5, score: 40 }],
        },
      };

      // Function to set scatter plot option
      function setScatterOption(data) {
        // Transform data for scatter plot (distance and score)
        var transformedData = data.map(function (item) {
          return {
            value: [item.distance, item.score, item.number],
            symbolSize: item.number * 10, // Adjust the multiplier as needed
            // Additional properties for your data can go here
          };
        });

        scatterOption = {
          tooltip: {
            trigger: "item",
            axisPointer: { type: "cross" },
            formatter: function (params) {
              return (
                "Distance: " +
                params.value[0] +
                "km<br>Score: " +
                params.value[1]
              );
            },
          },
          xAxis: {
            name: "Distance to Metro (km)", // Name for x-axis
            min: 1,
            max: 10,
            // Additional xAxis configuration here
          },
          yAxis: {
            name: "Score", // Name for y-axis
            min: 1,
            max: 100,
            // Additional yAxis configuration here
          },
          series: [
            {
              data: transformedData,
              type: "scatter",
              symbolSize: function (val) {
                // Scale the dot size based on the 'number' (3rd element in the array)
                return val[2] * 10; // Adjust this multiplier as needed
              },
              itemStyle: {
                color: "#1f77b4", // Change this color to make the dots visible
              },
              label: {
                normal: {
                  show: true,
                  formatter: function (params) {
                    // The 'number' is now directly in params.value[2]
                    return params.value[2];
                  },
                  position: "inside",
                },
              },
            },
          ],
          graphic: {
            elements: [
              {
                type: "text",
                style: {
                  text: "Inside the dot, the number represents Quantity",
                  fontSize: 14,
                },
                right: 20,
                bottom: 20,
              },
            ],
          },
        };
        scatterChart.setOption(scatterOption);
      }

      // Load the Guangdong GeoJSON data
      // Correct the URL to point to the raw JSON content
      $.getJSON(
        "https://raw.githubusercontent.com/PalaceTony/guangdong_geojson/main/mergedfile.geojson",
        function (geoJson) {
          echarts.registerMap("Guangdong", geoJson);
          // Map option
          mapOption = {
            tooltip: {
              trigger: "item",
              formatter: "{b}",
            },
            series: [
              {
                name: "Guangdong",
                type: "map",
                map: "Guangdong",
                emphasis: {
                  label: {
                    show: true,
                  },
                },
                data: Object.keys(mapPoints).map(function (district) {
                  return { name: district, value: mapPoints[district].value };
                }),
                // MarkPoint for displaying points on the map
                markPoint: {
                  symbolSize: 10,
                  label: {
                    normal: {
                      show: false, // Hide label text
                    },
                    emphasis: {
                      show: false, // Hide label text on hover
                    },
                  },
                  data: Object.keys(mapPoints).map(function (district) {
                    return {
                      name: district,
                      coord: mapPoints[district].value,
                    };
                  }),
                },
              },
            ],
          };

          // Apply the map option to the map chart
          mapChart.setOption(mapOption);
        }
      );

      // Map click event listener
      mapChart.on("click", function (params) {
        // Check if the click is on a markPoint
        if (mapPoints[params.name]) {
          setScatterOption(mapPoints[params.name].scatter);
        }
      });
    </script>
  </body>
</html>

# Challenges and Limitations
## Identify Challenges
Discuss any challenges faced in locating and assessing the sanitary pad stations.

## Study Limitations
Address any limitations of your research methods or data.

# Recommendations and Future Work
## Improving Accessibility
Suggest ways to increase the accessibility and number of sanitary pad stations.

## Policy Recommendations
Propose policy or public health recommendations based on your findings.

# Conclusion
## Summary of Findings
Concisely recap the key findings and insights from your study.

## Closing Remarks
Reflect on the importance of sanitary pad accessibility in urban areas.

# References
List of Sources: Include all the references and data sources used in your study.


